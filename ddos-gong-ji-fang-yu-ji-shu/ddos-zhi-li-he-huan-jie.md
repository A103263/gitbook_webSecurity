---
description: DDos治理和缓解
---

# DDos治理和缓解

部分内容摘自安全脉搏：[https://www.secpulse.com/archives/65477.html](https://www.secpulse.com/archives/65477.html)

## DDos攻击的要素

* 僵尸网络的广泛传播（loT）
* 互联网上基础设施安全缺陷，如DNS、NTP等
* 源IP的伪造非常容易 
* 应用设计时未考虑资源利用问题

## 僵尸网络治理

> * 僵尸网络是DDoS攻击的源头 
> * 从终端上治理僵尸网络很难起到显著效果
> * 获取僵尸程序样本，进行逆向分析，编写清除程序，分析网络特征
> * 在网络出口拦截僵尸网络流量 
> * 未加密的僵尸网络流量可以直接进行流量分析，并拦截

### 终端防御

从用户端进行防御 

* 信息安全意识普及 
* 设置防火墙白名单 
* 更新杀毒软件 
* IoT设备的固件更新 
* 降低普通用户权限

### 基础设施防御

> 基础设施主要用于反射型DDOS放大流量，常见有DNS、NTP、TFTP、SNMP、GENCHAR、SSDP等

#### DNS反射器的防御

* 限制源地址范围，降低被利用的可能性 
* 启用RRL策略（response rate limiting），限制响应速度 
* 普通用户不要在广域网上提供响应DNS数据包

#### NTP反射器防御

* 关闭默认的monlist功能，在ntp.conf配置文件中增加disable monitor选项 
* 升级ntp server至4.2.7p26或更高
* 在网络出口封禁UDP 的 123端口

#### TFTP反射器防御

* 限制源地址范围，降低被利用的可能性
* 配置TFTP重传次数

### 流量型防御

> 针对流量型的DDOS攻击，可用流量稀释的办法来提高服务可用性，例如使用CDN网络或使用Anycast

#### CDN网络

* CDN网络通常需要智能DNS配合
* 不同网络用户，通过智能DNS解析会得到最近的IP地址
* 对于静态页面，CDN节点中若有缓存直接返回没有缓存，则请求网站资源

CDN技术的初衷是提高互联网用户对网站静态资源的访问速度，**但是由于分布式多节点的特点，它也能够对分布式拒绝服务攻击的流量产生稀释的效果**。

CDN，就是在互联网范围内广发设置多个节点作为代理缓存，并将用户的访问请求导向最近的缓存节点，以加快访问速度的一种技术手段。

那么，用户的访问请求是如何被导向最近的缓存节点的呢？这通常通过智能DNS来实现，在许多情况下，对于资源和服务的访问请求是以域名的形式发出的，传统的域名解析系统会将同一域名的解析请求解析成一个固定的IP，因此，整个互联网对于该域名的访问都会导向这个IP地址。

![](../.gitbook/assets/image%20%2883%29.png)

 智能DNS则有所不同，在智能DNS系统中，**一个域名会对应一张IP地址表**，**当收到域名解析请求时，智能DNS会查看解析请求的来源，并给出地址表中距离请求来源最接近的IP地址**，这个地址通常也就是最接近用户的CDN缓存节点的IP地址，在用户收到域名解析应答时，认为该CDN节点就是他请求的域名所对应的IP地址，并向该CDN节点发起服务或资源请求。

![CDN&#x7F51;&#x7EDC;](../.gitbook/assets/image%20%2865%29.png)

在发生了分布式拒绝服务攻击时，智能DNS会将来自不同位置的攻击流量分散到对应位置的DNS节点上，这使得CDN节点成为区域性的流量吸收中心，从而达到流量稀释的效果。**在流量被稀释到各个CDN节点后，就可以在每个节点处进行流量清洗，只将正常的请求交付给源站，从而达到防护源站的目的。**

不过，利用智能DNS实现的CDN技术智能分散和稀释通过域名发起的分布式拒绝服务攻击的流量，**如果攻击者直接通过IP而不是通过域名进行攻击，那么不会进行智能DNS解析**，攻击流量也无法分散到各个CDN节点上。更好的流量稀释方法是使用Anycast技术。

#### Anycast技术

Anycast技术是一种网络寻址和路由的方法，通过使用Anycast，**一组提供特定服务的主机可以使用相同的IP地址，同时，服务访问方的请求报文将会被IP网络路由到这一组目标中拓扑结构最近的一台主机上**。

Anycast通常是通过在不同的节点处同时使用BGP协议向外声明同样的目的IP地址的方式实现的，如图，服务器A和服务器B是Anycast的两个节点，他们通过BGP协议同时向外声明其IP地址为10.0.0.1。

![](../.gitbook/assets/image%20%2875%29.png)

 当客户端位于路由器1的网络内时，他将会通过路由器1来选择路由的下一跳，而在路由器1看来，到达服务器IP地址10.0.0.1的网络拓扑如图。

![](../.gitbook/assets/image%20%2820%29.png)

显然，转发到路由器2的距离最短，因此，路由器1会将请求报文转发给路由器2而不是路由器3，从而实际上发送给服务器A，**达到发送给Anycast之中“最近”节点的目的**。

{% hint style="info" %}
对无状态的服务Anycast通常用来提高可用性保障和负载均衡，例如DNS服务。**几乎全部的互联网根域名服务器都部署了Anycast**。在各大洲不同位置的A,C,E,F,I,J,K,L和M根域名服务器都使用了Anycast寻址技术，以提供一种分布式的服务。同时，许多商业DNS服务提供商也部署了Anycast寻址以便提高查询性能，保障系统冗余并实现负载均衡。

Anycast通常具有高度的可靠性，它可以提供自动故障恢复。Anycast应用通过外部“心跳”来监测服务器的功能，如果服务器出现故障，就会立即撤销服务器的理由公告。
{% endhint %}



使用Anycast技术能够稀释分布式拒绝服务攻击流量，在Anycast寻址过程中，流量会被导向网络拓扑结构上最近的节点，在这个过程中，攻击者并不能对攻击流量进行操控，因此攻击流量将会被分散并稀释到最近的节点上，每一个节点上的资源消耗都会减少（见图）。

![](../.gitbook/assets/image%20%28102%29.png)

### 应用型防御

#### 简单识别

IP信誉检查：是指为互联网上的IP地址赋予一定的信誉值，经常被作为僵尸主机发送垃圾邮件或发动拒绝服务攻击的IP地址会被赋予较低的信誉值，说明这些IP地址更有可能成为网络攻击的来源。

 指纹识别技术：DDoS攻击工具，发起攻击的网络数据载荷，为预先编写好的固定特征。流量清洗设备厂商可以提取这些特征，作为指纹识别，类似杀毒软件。

#### 速度检查与限制

DDOS在数据包发送速度上往往有一定特征，如：

* UDP flood是快速发包，通过海量数据来耗用带宽 
* THCSSLDOS，并不需要很快速度，只是在同一个会话中不停协商密钥 
* Slow http，发包数度并不快，但会长期占有会话

这些特征都可以作为识别相应的DDOS攻击的一种速度特性

#### TCP代理与检测

TCP检测源地址： 

* 防火墙通过发送SYN+ACK+错误SEQ 
* 正常客户端：回应RST后再发起SYN 
* 异常客户端：无响应

![](../.gitbook/assets/image%20%2856%29.png)

TCP代理原理：

流量清洗设备在建立三次握手后，再将数据发送给真实服务器

![](../.gitbook/assets/image%20%2881%29.png)

#### HTTP客户端验证

HTTP302重定向：

客户端发送正常请求，流量清洗设备回应302重定向。根据客户端是否执行重定向动作来确认客户端的真伪

![](../.gitbook/assets/image%20%2817%29.png)

HTTP启用javescript验证：

在http页面，执行javescript脚本，根据客户端执行结果来判断客户端真伪

![](../.gitbook/assets/image%20%2824%29.png)

验证码人机识别：

在HTTP页面，启用验证码，来判断客户端的真伪

![](../.gitbook/assets/image%20%2898%29.png)

